## 1. 万维网
### 1.1. 万维网的特征
万维网提供了一种通过因特网方便使用的文档格式(网页)和一种能够方便访问这样的网页的方式(浏览器).

### 1.2. 超文本
每个网页都可以在任何位置设置一个指向另一个网页的虚拟链接，访问者通过这些链接能够直接从一个网页转到另一个.

### 1.3 将万维网看作有向图
1. 链入 (IN): 所有能够链接到超大强连通分量(SCC)，但不能通过超大 SCC 链接访问的节点. 即超大 SCC 的上游节点. 
2. 链出 (OUT): 所有能够通过超大 SCC 链接访问，但不能链接到超大 SCC 的节点. 即超大 SCC 的下游节点.
3. 卷须(Tendrils): 能够从链入集合链接访问但不能链接到超大 SCC 的节点或者有路径到链出集合，但不能从超大 SCC 访问的节点
4. 游离(Disconnected): 即使我们完全忽略边的方向性, 也不存在到超大SCC的路径的节点

![image-20230710210545383](Lecture%204.%20万维网和搜索引擎.assets/image-20230710210545383.png)


## 2. 中枢与权威
### 2.1. 权威性(auth)
权威性从链入的角度来考察网页. 如果一个网页被很多网页指向, 那么它的权威性比较高. 

### 2.2. 中枢性(hub)
中枢性从链出的角度来考察网页. 如果一个网页指向很多网页, 那么它的中枢性比较高. 

### 2.3. 计算方法(HITS算法)
1. 初始化: 令所有节点的权威性和中枢性都为1
2. 权威更新规则: 对于每个网页$p$, 以所有指向该网页的网页中枢值之和更新这个网页的权威值$\mathrm{auth}(p)$
3. 中枢更新规则: 对于每个网页$p$, 以所有该网页指向的网页权威值之和更新这个网页的中枢值$\mathrm{hub}(p)$
4. 归一化: 令所有节点的权威值和中枢值都除以${\sum\limits_{p} \mathrm{auth}(p)}$和${\sum\limits_{p} \mathrm{hub}(p)}$

当操作次数足够多时, 经过归一化处理的权威值和中枢值会收敛于稳定的极限值
___
##### Proof
用$M$表示网络的邻接矩阵. 用$\boldsymbol{h}$表示网络节点的中枢值, 用$\boldsymbol{a}$表示网络节点的权威值. 则更新规则可以写成
1. 权威更新规则: $\boldsymbol{a} = M^{\top}\boldsymbol{\boldsymbol{h}}$
2. 中枢更新规则: $\boldsymbol{h} = M \boldsymbol{a}$
  

设中枢值和权威值的初始向量分别为$\boldsymbol{h}^{(0)}$和$\boldsymbol{a}^{(0)}$, 则我们有
$$
\boldsymbol{a}^{(k)} = (M^{\top}M)^{k-1}M^{\top}\boldsymbol{h}^{(0)}, \quad \boldsymbol{h}^{(k)} = (MM^{\top})^{k}\boldsymbol{h}^{(0)}
$$
设$M^{\top}M$的特征值为$\lambda_1 \geq \lambda_2 \geq \cdots \geq \lambda_n$, 对应的特征向量为$\boldsymbol{v}_1, \boldsymbol{v}_2, \cdots, \boldsymbol{v}_n$. 将$\boldsymbol{h}^{(0)}$沿着特征向量方向分解, 设
$$
\boldsymbol{h}^{(0)} = \sum\limits_{i=1}^{n} \alpha_i \boldsymbol{v}_i
$$
于是
$$
\boldsymbol{h}^{(k)} = \sum\limits_{i=1}^{n} \alpha_i \lambda_i^{k} \boldsymbol{v}_i
$$
也就是说
$$
\dfrac{\boldsymbol{h}^{(k)}}{\lambda_1^k} = \alpha_1 \boldsymbol{v}_1 + \sum\limits_{i=2}^{n} \alpha_i \left(\dfrac{\lambda_i}{\lambda_1}\right)^k \boldsymbol{v}_i
$$
这就给出了收敛结果的显式表示. 
#####
___


## 3. 网页排名
### 3.1. PageRank算法
1. 初始化: 对于一个有 $n$ 个节点的网络, 设所有节点的网页排名的初值为 $\dfrac{1}{n}$ 
2. 更新: 每个网页均等地将自己当前的网页排名值分配给所有向外的链接, 这些链接将这些均等的值传递给所指向的网页 (如果网页没有指向其他网页的链接, 就将当前所有网页排名传递给自身); 每个网页以获得的所有网页排名值的总和来更新自己的网页排名
3. 收敛: 多次迭代以后, 除了少数退化情况以外, 都能够得到一组确定的收敛值

PageRank最大的问题在于, 如果在网络中存在只有链入没有链出的网页, 最终的排名值会集中到那个网页上. 

### 3.2. 同比缩减算法
首先运行基本网页排名更新规则. 然后利用缩放因子$s$缩小所有网页的排名值. 着意味着网络中网页排名值的总和由$1$缩小到$s$. 将剩余的网页排名值$1-s$平均分给所有的节点, 每个节点得到$\dfrac{1-s}{n}$. 在实际应用中, 通常将比例因子$s$选择在$0.8-0.9$之间. 引入比例因子$s$还可以减少网络排名对加入或减少少量节点和链路的敏感度. 

### 3.3. 随机游走算法
经过$k$个步骤的随机游走, 到达网页$X$的概率恰好是网页$X$经过$k$次基本更新规则运算所得到的网页排名. 

经过$k$步缩放随机游走到达网页$X$的概率, 与网页$X$运行$k$次缩放网页排名更新规则而得到的网页排名值完全一致. 


## 4. 搜索引擎广告定价

### 4.1. 互联网广告的付费方式
1. 按展示计费: 只要搜索引擎将广告放在页面中就向厂商收费
2. 按行动计费: 按照每次点击收费(cost-per-click, CPC)
3. 按销售计费: 按照每次销售收费(cost-per-action, CPA)

### 4.2. 广告定价
1. 匹配市场: 如果搜索引擎事先知道所有广告商对点击的估价, 这就转化为了一个最优分配问题
2. 竞价拍卖: 如果广告商的对点击的估价不为人知, 就需要有一种竞拍方式来出售广告位

### 4.3. VCG价格
假设买方拥有独立的私密估价. 每个买方所支付的价格为因获得该商品对其余买方造成的价值损失的总和. 这个总值是在该买家没有出现的情况下达到最优匹配时, 其他买家所能提高的估值总和. 
![image-20230710210520139](Lecture%204.%20万维网和搜索引擎.assets/image-20230710210520139.png)

用$p_{ij}$表示买方$j$为获得商品$i$所支付的VCG价格, 则有
$$
p_{ij} = V_{B -j}^S - V_{B-j}^{S-i}
$$

### 4.4. VCG机制
VCG机制的工作过程如下: 
1. 要求买方宣布他们对商品的估价(可以不必真实)
2. 选择一个买方和商品的社会最优分配方案(一个完美匹配, 使得每个买方所获得的商品估值总和最高)
3. 每个买方支付相应的VCG价格. 


如果按照VCG机制分配商品并计算价格, 报告真实估价是每个买方的占优策略, 并且在所有的商品和买方形成的完美匹配中, 这种分配结果使得估值总和最高. 
___
##### Proof
上述结论的后一部分(估值总和达到最大)比较容易证明, 如果买方真实报告估价, 那么从定义上商品的分配就是使得总估值达到最高. 

下面证明前一部分(真实报告估价是占优策略). 假如$j$说了假话, 但获得的是同一个商品, 那么$j$的回报仍然不变, 因为价格$p_{ij}$是由其他买方宣布的估价计算得到的, 与$j$的虚假报价无关. 而如果买方$j$报告了虚假估价, 并且因子获得了另一个商品$h$, 而不是$i$. 这时, $j$得到的回报应该是$v_{hj} - p_{hj}$. 我们需要证明
$$
v_{ij} - p_{ij} \ge v_{hj} - p_{hj} \iff v_{ij} - [V_{B-j}^S - V_{B-j}^{S-i}] \ge v_{hj} - [V_{B-j}^S - V_{B-j}^{S-h}]
$$
于是只需要证明
$$
v_{ij} + V_{B-j}^{S-i} \ge v_{hj} + V_{B-j} ^{S-h}
$$
等式的左边是将买方$j$与项目$i$进行最优匹配, 然后再对其他买方和项目进行最优匹配构造得到的. 因此左边可以写成$V_{B}^S$. 而右边是某一个匹配. 因此不等式成立. 这就得到了我们需要的结果. 
#####
___

### 4.5. VCG价格是市场出清价格
在任何匹配市场中, VCG 价格形成一组唯一的总价之和最低的市场清仓价格


### 4.6. GSP机制
GSP 机制即广义次价拍卖机制, 它是对单品次价拍卖的直接推广, 广告商将每个广告位 $i$ 分配给 出价排在第 $i$ 位的广告商, 所支付的每次点击价格是出价排在第 $i+1$ 位广告商的出价. 

### 4.7. GSP机制的均衡
1. 真实报价不一定能形成纳什均衡. 以下图为例, 广告商$x$的真实报价为$7$, 它有动机将报价降低到$5$来获得更多的利润.
2. GSP机制中可能出现多重纳什均衡. 以下图为例, 不难验证$(5,4,2)$和$(3,5,1)$都是纳什均衡.
3. 采用GSP机制产生的收入有可能比采用VCG机制更高, 也可能比采用VCG机制更低. 以下图为例, 均衡$(5,4,2)$的收入为$48$, 均衡$(3,5,1)$的收入为$34$, 而VCG机制的收入为$44$.
   ![image-20230710222757035](./Lecture%204.%20%E4%B8%87%E7%BB%B4%E7%BD%91%E5%92%8C%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E.assets/image-20230710222757035.png)
4. GSP 机制总是存在一组满足社会最优的均衡出价
___
##### Proof
考虑一组广告商和广告位的情况, 不失一般性, 假设广告商和广告位的数量相同, 都为$n$(否则可以添加价值为0的广告位或删去低点击率的广告位). 设广告商以每点击估值递减的顺序排列, 广告位以点击率递减的顺序排列. 用$p_1, p_2, \cdots, p_n$表示广告位的市场清仓价格, 同样, 这些价格也是每个广告位一定点击数量的价格. 根据[市场清仓定理](Lecture%201.%20关系的平衡和议价#4.3.%20市场清仓定理), 偏好卖家图的完美匹配能够满足广告商对广告位的估值总和最高, 这意味着第$i$号广告商获得第$i$个广告位. 

考虑市场清仓价格对应的每点击价格$p_j^* = \dfrac{p_j}{r_j}$, 显然$p_1^*\ge p_2^*\ge \cdots\ge p_n^*$. 可以简单地让广告商的出价为
$$
\mathrm{bid}_i = \begin{cases}  p_1^*+1 & i=1\\ p_{i-1}^* & 1<i\le n \end{cases}
$$
容易验证, 这样的出价是一组纳什均衡. 
#####
___